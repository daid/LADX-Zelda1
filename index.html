<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mini.css/3.0.1/mini-default.min.css">
<link rel="shortcut icon" type="image/x-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAADAFBMVEWWlv8AAAA7tHD73cUEBAQFBQUGBgYHBwcICAgJCQkKCgoLCwsMDAwNDQ0ODg4PDw8QEBARERESEhITExMUFBQVFRUWFhYXFxcYGBgZGRkaGhobGxscHBwdHR0eHh4fHx8gICAhISEiIiIjIyMkJCQlJSUmJiYnJycoKCgpKSkqKiorKyssLCwtLS0uLi4vLy8wMDAxMTEyMjIzMzM0NDQ1NTU2NjY3Nzc4ODg5OTk6Ojo7Ozs8PDw9PT0+Pj4/Pz9AQEBBQUFCQkJDQ0NERERFRUVGRkZHR0dISEhJSUlKSkpLS0tMTExNTU1OTk5PT09QUFBRUVFSUlJTU1NUVFRVVVVWVlZXV1dYWFhZWVlaWlpbW1tcXFxdXV1eXl5fX19gYGBhYWFiYmJjY2NkZGRlZWVmZmZnZ2doaGhpaWlqampra2tsbGxtbW1ubm5vb29wcHBxcXFycnJzc3N0dHR1dXV2dnZ3d3d4eHh5eXl6enp7e3t8fHx9fX1+fn5/f3+AgICBgYGCgoKDg4OEhISFhYWGhoaHh4eIiIiJiYmKioqLi4uMjIyNjY2Ojo6Pj4+QkJCRkZGSkpKTk5OUlJSVlZWWlpaXl5eYmJiZmZmampqbm5ucnJydnZ2enp6fn5+goKChoaGioqKjo6OkpKSlpaWmpqanp6eoqKipqamqqqqrq6usrKytra2urq6vr6+wsLCxsbGysrKzs7O0tLS1tbW2tra3t7e4uLi5ubm6urq7u7u8vLy9vb2+vr6/v7/AwMDBwcHCwsLDw8PExMTFxcXGxsbHx8fIyMjJycnKysrLy8vMzMzNzc3Ozs7Pz8/Q0NDR0dHS0tLT09PU1NTV1dXW1tbX19fY2NjZ2dna2trb29vc3Nzd3d3e3t7f39/g4ODh4eHi4uLj4+Pk5OTl5eXm5ubn5+fo6Ojp6enq6urr6+vs7Ozt7e3u7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8/Pz9/f3+/v7///8mTZs4AAAAa0lEQVR4nN3SSw7AIAgEUEfuf+dKLBVbEHHZ2fISPqGU3wV3TgFQW6jFIQEAiASYZAv0MMsDHlCDT5MNoEc0xgwAn3de8nXwAHBRD9kXPgFM+pGyQB6lPjG3WILxbE45BLIkpmTAaOGUV+ACyGsDff+yfN8AAAAASUVORK5CYII=">
<style>
.container {
    max-width: 1100px;
    background: #FFF;
    border: solid 1px #666;
    border-radius: 10px;
    margin-top: 20px;
    padding-bottom: 20px;
    margin-bottom: 200px;
}
.selectromwarning {
    box-shadow: inset 0 0 0 2px red;
}
</style>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script>
"use strict";
function ID(s) { return document.getElementById(s); }
var result_filename = "LADX-Zelda1.gbc";
var patch_data;
var input_data;
addEventListener("DOMContentLoaded", async function(event) {
    var result = await fetch('output.ips');
    patch_data = new Uint8Array(await result.arrayBuffer());
    ID("rom").onchange = async function() {
        var rom = ID("rom");
        if (rom.files.length < 1) {
            setValidRom(false);
        } else if (rom.files[0].size != 1024 * 1024) {
            var ext = rom.files[0].name.substr(rom.files[0].name.lastIndexOf(".")).toUpperCase();
            if (ext == ".ZIP")
                setValidRom(false, "Rom needs to be unzipped.");
            else
                setValidRom(false, "Invalid ROM size, needs to be 1048576 bytes.");
        } else {
            var buffer = new Uint8Array(await rom.files[0].arrayBuffer());
            var checksum = 0;
            for(var b of buffer) { checksum += b; }
            console.log("Checksum: " + rom.files[0].name + ": " + checksum);
            if (checksum != 89122269)
            {
                if (checksum == 89139089)
                    setValidRom(false, "Supplied English 1.1 instead of 1.0");
                else if (checksum == 89653611)
                    setValidRom(false, "Supplied English 1.2 instead of 1.0");
                else if (checksum == 89199617 || checksum == 89757956)
                    setValidRom(false, "Supplied French instead of English version");
                else if (checksum == 89992511 || checksum == 90082342)
                    setValidRom(false, "Supplied German instead of English version");
                else if (checksum == 87464316 || checksum == 87479931 || checksum == 87503721)
                    setValidRom(false, "Supplied Japanese instead of English version");
                else
                    setValidRom(false, "Invalid ROM");
            } else {
                input_data = buffer;
                setValidRom(true);
            }
        }
    }
    ID("submitbutton").onclick = function() {
        applyPatch();
        downloadRom();
    }
});

function setValidRom(valid, msg)
{
    ID("submitbutton").disabled = !valid;
    if (valid)
        ID("romlabel").classList.remove("selectromwarning");
    else
        ID("romlabel").classList.add("selectromwarning");
    if (msg)
        ID("romlabel").innerHTML = msg;
    else
        ID("romlabel").innerHTML = "Select input ROM";
}

function applyPatch()
{
    for(var idx=5; idx<patch_data.length-3;) {
        var offset = (patch_data[idx] << 16) | (patch_data[idx+1] << 8) | patch_data[idx+2];
        var size = (patch_data[idx+3] << 8) | patch_data[idx+4];
        idx += 5;
        if (size == 0) {
            //RLE
            var size = (patch_data[idx] << 8) | patch_data[idx+1];
            var value = patch_data[idx+2];
            idx += 3;
            for(var n=0; n<size; n++) {
                input_data[offset+n] = value;
            }
        } else {
            for(var n=0; n<size; n++) {
                input_data[offset+n] = patch_data[idx+n];
            }
            idx += size;
        }
    }
}

function downloadRom() {
    var blob = new Blob([input_data], {type: "application/octet-stream"});
    var element = document.createElement('a');
    element.href = window.URL.createObjectURL(blob);
    element.download = result_filename;
    element.click();
}
</script>
</head>
<body>

<div class="container">
    <h1>LADX-Zelda1: The Legend of Zelda: Link's Awakening DX - Zelda 1</h1>
    What is this? It is Zelda1 re-envisioned on the Link's Awakening DX engine for the gameboy.

    <ul>
    <li>It has the full overworld of Zelda1
    <li>The first 8 zelda 1 dungeons are there. The massive dungeon 9 was not added.
    <li>Every place where Zelda1 has a secret this hack has something as well
    <li>There are differences, but the main structure is followed.
    <li>There is a hidden secret color dungeon.
    <li>Note that depending on your route in D1, you can lock yourself out of completing it until you get bombs from somewhere else. This is not a bug but an unfortunate way Zelda1 designed this dungeon.
    </ul>

    <div class="row">
        <div class="col-sm-12 col-md-6 tooltip bottom" aria-label="Requires 'Legend of Zelda, The - Link's Awakening DX (V1.0)' English version">
            <input type="file" id="rom" name="rom" style="display:none" accept=".gbc"/>
            <label style="width:100%; box-sizing: border-box; text-align: center" for="rom" class="button" id="romlabel">Select input ROM</label>
        </div>
        <div class="col-sm-12 col-md-6 tooltip bottom" aria-label="Let's go!">
            <input style="width:100%" id="submitbutton" type="submit" value="Generate!" disabled/>
        </div>
    </div>

    Enjoying this? Then also check out:
    <ul>
    <li><a href="https://daid.github.io/LADXR/">LADX - Randomizer</a>
    </ul>
</div>

</body>
</html>
